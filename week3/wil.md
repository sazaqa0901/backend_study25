#백엔드 정규 스터디 3주차 과제
<sub>C335282 이예영</sub>

어플리케이션이 사용할 DB 설계
JPA를 이용한 DB 구현

스프링 Layered Architecture

DB 설계
문제 상황 -> 프로그램으로 추상화
개체(엔티티/문제 상황을 구성하는 요소)와 그 사이의 관계(개체와 개체 사이의 관계)로 나타낼 수 있음

개체와 관계는 속성(세부적인 특징)을 가질 수 있음
ex. PK(Primary Key) :하나의 개체를 식별할 수 있는 속성

ER Model :개체와 관계로 표한하는 방법 -> 다이어그램으로 표현한 것 :ERD
ex. 개체 -> 테이블 / 관계 -> 테이블 or 외래키 / 속성 -> 테이블 컬럼
ERD Cloud로 ERD를 그릴 수 있음

개체와 개체 사이의 관계 -다대일(N:1) -일대다(1:N) -일대일(1:1) -다대다(N:N)
ex. 1명의 유저는 여러 개의 할 일을 생성 가능, 1개의 할 일은 1명의 유저에 대한 할 일
=> 유저-할 일 = 1:N -> 외래키로 구현

식별관계 :관계 대상의 PK를 자신의 PK로도 사용하는 것
비-식별 관계 : 관계 대상의 PK를 자신의 FK로만 사용하는 것

N:M
회원은 여러 동아리에 소속될 수 있음 => 1:N
동아리는 여러 회원을 가질 수 있음 => 1:M
회원-동아리 = N:M => 쌍(회원PK-동아리PK)을 저장하는 테이블을 만들어 구현
관계는 꼭 서로 다른 엔티티끼리 맺지 않아도 됨(유저-유저 -> 같은 종류의 유저 엔티티끼리 관계를 맺을 수 있음)

JPA(Java Persistence API)
데이터베이스에서 읽어온 데이터를 자바 객체로 매핑하는 자바의 표준 기술(ORM)
엔티티(Entity) :자바와 데이터베이스가 소통하는 단위
테이블의 데이터 하나(레코드)는 엔티티 객체 하나로 매핑됨

엔티티 클래스 정의 -> JPA가 엔티티 클래스 정의를 보고 테이블을 생성하는 SQL을 알아서 작성하고 실행(SQL 작성 시간 줄일 수 있음)

JPA가 데이터베이스와 소통하는 과정
id가 1인 유저 데이터 조회 -> JPA에게 부탁 -> 실제 데이터베이스와 소통할 SQL작성

JPA 설정 파일 작성 -스프링 부트는 기본적으로 H2 in-memory DB를 사용
-DB에 저장된 데이터를 볼 수 있도록 관리자 콘솔을 활성화, 관리자 콘솔에 접속할 url을 명시(명시X -> 매번 랜덤 url 생성)

엔티티클래스
-@Entity 어노테이션으로 이 클래스가 엔티티라는 것을 명시
-@Id 어노테이션으로 PK 필드에 이 필드가 PK라는 것을 명시
-id 값은 보통 데이터를 생성할 때마다 자동으로 1씩 늘어남
-@GeneratedValue를 사용하면 id 값을 자동으로 생성 / 이때 strategy는 IDENTITY로 설정(키 값 결정을 DB에 위임)
-ERD에서 설계했던 Column 이름과 타입을 맞추기 위해
필드에 @Column 으로 이름과 타입을 명시

외래키를 직접 저장한다면? -외래키를 직접 저장 -> 연관된 데이터가 필요할 때 외래키로 데이터를 조회하는 코드를 직접 작성 -엔티티로 저장 -> 테이블을 만들 때 외래키를 만들어줌/ 연관된 데이터가 필요할 때 자동으로 join 쿼리가 실행되고 연관 데이터 얻음

외래키 필드에 지정해야하는 2가지 어노테이션

1. @JoinColumn(FK 컬럼 정보는 명시하는 어노테이션)
2. @ManyToOne @OneToOne @OneToMany @ManyToMany(해당 외래키로 생기는 연관관계 종류를 나타내는 어노테이션)

fetch 속성(연관관계 종류를 나타내는 어노테이션의 속성)
:연결된 엔티티를 언제 가져올지 명시
type
EAGER : 즉시 로딩, Todo 객체 정보를 가져올 때 연결된 User 객체의 모든 정보를 함께 한번에 가져옴
LAZY : 지연 로딩, Todo 객체 정보를 가져올 때 연결된 User 객체의 정보는 필요할 때 가져옴

@NoArgsConstructor : 인자 없는 생성자 생성성(이때 access 속성을 통해 접근 제한자를 protected로 설정)
